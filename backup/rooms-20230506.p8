pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
  xp=56
  yp=120
  sp=1
  
  pl_init()
  
  map_setup()
  
  debug= "d-1"
  debug2="d-2"
  debug3="d-3"
  debug4="d-4"
end


function _update60()
  -- pl_render()
  move_pl()
end

function _draw()
		cls()
		draw_map()
		pl_draw()

		print(debug,0,0,11)
		print(debug2,0,8,10)
		print(debug3,0,16,12)
		print(debug3,0,24,11)
end





-->8
-- map code
function map_setup()
	wall=0
	key=1
	door=2
	anim1=3
	anum2=4
	lose=6
	win=7
end

function draw_map()
	mapx=flr(p.x/128)*128
	mapy=flr(p.y/128)*128
	camera(mapx,mapy)
	
	map(0,0,0,0,128,64)
	--map()
end


-->8
-- player code

function pl_init()
	p={}
 p.x=56
 p.y=56
 p.sp=0.5
 p.s=0
 p.flipx=false
 
 p.way="r" --right,left,top,bottom

	p.ways={
		l={ss={0,1,2,3,4}},
		r={ss={0,1,2,3,4}},
		u={ss={10,11,12,13,14}},
		d={ss={5,6,7,8,9}},
	}
	p.run={
		delay=4,
		ss_count=2,
	}
	
	p.fire={
	qty=3,
	am={	
		{s=15,x=0,y=0,
		 flipx=false,flipy=false},
		}
	}
end

function pl_draw()
 spr(p.s,p.x,p.y,1,1, p.flipx)
 spr(p.fire[1].s,p.x-8,p.y+8,1,1, p.flipx)
end

function move_pl()
	local newx=p.x
	local newy=p.y
	local sp=p.sp
	
	-- check for spite change
	if (btn(⬅️)) then
	 p.way="l"
	elseif (btn(➡️)) then
	 p.way="r"
	elseif (btn(⬆️)) then
	 p.way="u"
	elseif (btn(⬇️)) then 
  p.way="d"
	end
	
	// check way for moving
	--if(
	-- (btn(⬅️) or btn(➡️)) and
	--	(btn(⬆️) or btn(⬇️))
	--) then
	
	 --local slow_sp=p.sp/sqrt(2)
	-- local x_way=
	--  btn(⬅️) and -1 or 1
	-- local y_way=
	--  btn(⬆️) and -1 or 1
	-- newx = newx+sp*x_way
	-- newy = newy+sp*y_way
	--else
	
	if (btn(⬅️)) then
	 newx-=sp
		p.flipx=true
	elseif (btn(➡️)) then
	 newx+=sp
		p.flipx=false
	elseif (btn(⬆️)) then
	 newy-=sp
	elseif (btn(⬇️)) then 
  newy+=sp
	end
	
	
	
	if (
		btn(⬅️) or 
		btn(➡️) or 
		btn(⬆️) or 
		btn(⬇️)
	) then
		pl_run_anim()
	else pl_set_default()
	end
	
--	newx=flr(newx)
--	newy=flr(newy)
	
	--local tle=mget(flr(newx)/8,flr(newy)/8)
	--debug = tle
	
	if (can_move(newx,newy)) then
	 p.x=newx
	 p.y=newy
	end

end


function pl_run_anim()
	p.run.delay-=1
	
	-- sprite change
	if (p.run.delay==0) then
 	p.s=p.ways[p.way].ss[p.run.ss_count]
		p.run.ss_count += 1
		
		if (p.run.ss_count > 5) then
			p.run.ss_count=2
		end
	end
	
	-- check & reset delay
	if (p.run.delay==0) then
	 p.run.delay=4
	end
end

function pl_set_default()
	p.run.ss_count=1
	p.s=p.ways[p.way].ss[p.run.ss_count]
	p.run.delay=4
end

function can_move(x,y)
	-- get sprites
	-- left-top, left-bottom,
	-- right-top, right-bottom
 -- !lazy:
 local lt,lb,rt,rb
 lt=mget((x+1)/8,  (y+6)/8)
 lb=mget((x+1)/8,  (y+7)/8)
 rt=mget((x-1+7)/8,(y+6)/8)
 rb=mget((x-1+7)/8,(y+7)/8)
 -- !strict old:
 --local lt=mget(x/8,    y/8)
 --local lb=mget(x/8,   (y+7)/8)
 --local rt=mget((x+7)/8,y/8)
 --local rb=mget((x+7)/8,(y+7)/8)
 
 -- check wall in same 4 ways
 local w_lt=fget(lt,0)
 local w_lb=fget(lb,0)
 local w_rt=fget(rt,0)
 local w_rb=fget(rb,0)
 
 debug=lt
 debug2=lb
 debug3=rt
 debug4=rb

	local main_ch=
	w_lt or w_lb or w_rt or w_rb

	return not main_ch
end





-->8

__gfx__
00555500000000000000000000000000000000000005550000000000000000000010000000000000000555000000000000000000000000000000000000000000
01111100011555500105555000055550000555500011110000055500010555000015550001055500000111100005550000055500000555000005550000000000
10f5f500000111100011111001111110001111100105f50001111100001111000001110000111100000555010001111100011110000111100001111000000000
001fff00000f5f50000f5f50000f5f50010f5f50000fff000005f5000005f5000005f5000005f500000fff000005550000055501000555100005550100000000
011111100011fff00011fff00011fff00011fff000111110001fff10001fff10001fff10001fff10001111100011111000111110001111100011111000000000
01f111f0001111f0001111f0001f1110001f1110001f1f1000111f1000111f10001f1110001f1110001111100011111000111110001111100011111000000000
00111100000f1110000f1110000111f0000111f000011100000f1100000f110000011f0000011f00000111000001110000011100000111000001110000000000
00100100000100100010001000100100000101000001010000010010000101000010010000010100000101000001001000010100001001000001010000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006600
00000000000666600006666000066660000666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000660
00000000000686800006868000068680000686800000000000000000000000000000000000000000000000000000000000000000000000000000000044444666
00000000000666600006666000066660000666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000660
00000000009999000099990000999900009999000000000000000000000000000000000000000000000000000000000000000000000000000000000000006600
00000000099690600996906009969060099690600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000099690000996900009969000099690000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000090090009000900090090000090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000001677000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000016111000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000067777000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000001666000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333444440540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333333330000000001d5431000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333333335055555501d5431000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333405444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333333334054444404314d5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333333330000000004314d5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333333335555505504314d5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333444440540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00658500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00166600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01611160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4141414141414141414141414141414141414141414141414141414141414141101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404140404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404140404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404140404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404140404040404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404041404040404140404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404240404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404141414141414040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404141414141414040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404141414141414040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4141414040414141414141414141414141414141414141414141404041414141101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4141414040414141414141414141414141414141414141414141404041414141101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404040404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4140404040404040404040404040404141404040404040404040404040404041101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
4141414141414141414141414141414141414141414141414141414141414141101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
